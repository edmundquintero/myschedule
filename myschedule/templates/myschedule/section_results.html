{% extends "myschedule/base-sidebar.html" %}

{% load myschedule_filters %}

{% block scripts %}{{ block.super }}
   <script type="text/javascript">
     var basePath = '{% url index %}';
     var buttonPath = '{% url appstatic "img/remove_button.png" %}';
   </script>
  <script type="text/javascript" src="{% url appstatic "js/sections.js" %}"></script>
{% endblock %}

{% block page_title %}{{ block.super }} | Search Results{% endblock %}
{% block buttons %} {% endblock %}
{% block content %}{{ block.super }}
  {% include "myschedule/search.html" %}
  {% if not user.is_authenticated or conflicts.conflicting_sections %}
    <br />
    <div class="message message-warning" id="conflict-login-message">
    {% if not user.is_authenticated %}
      <p id="login-message"><a href="{% url login %}">Sign in</a> to save this schedule!</p>
    {% endif %}
    {% if conflicts.conflicting_sections %}
      <p id="conflict-message">This schedule contains scheduling conflicts.</p>
    {% endif %}
    </div>
  {% endif %}
  {% if sections %}
    <form action="" method="POST" id="section-form">
      <div class="course">
        <div class="course-top"></div>
        <div class="course-content">
          <div class="course-metadata">
            <p class="course-number">{{ sections.0.course.prefix }} {{ sections.0.course.course_number }}</p>
            <p class="course-hours">{% if sections.0.ceus %}CEUs<br/>{{ sections.0.ceus }}{% else %}{% if sections.0.credit_hours %}Credit Hours<br/>{{ sections.0.credit_hours }}{% else %}No Credit{% endif %}{% endif %}</p>
          </div>
         <div class="course-description">
            <p class="course-name">{{ sections.0.course.title }}</p>
            <p>{{ sections.0.course.description }}</p>
            <p class="contact-hours">Contact Hours {{ section.0.contact_hours }}10</p>

              {% if sections.0.course.prerequisites or sections.0.course.corequisites %}
                <table class="requisites">
                <tbody>
                  <tr>
                    <td class="prereq">
                    {% if sections.0.course.prerequisites %}
                      <strong>Prerequisites:  </strong>
                      {% if sections.0.course.prerequisite_courses %}
                        {% for prereq in sections.0.course.prerequisite_courses %}
                          {% if not forloop.first %}, {% endif %}
                          {% if prereq.prereq_course.section_set.all %}
                            <a href="{% url show_sections prereq.prereq_course.id %}">{{ prereq.prereq_course.prefix }} {{ prereq.prereq_course.course_number }}</a>
                          {% else %}
                            {{ prereq.prereq_course.prefix }} {{ prereq.prereq_course.course_number }}
                          {% endif %}
                        {% endfor %}
                      {% else %}
                        Please check the <a href="{{ catalog_url }}" target="_blank">catalog</a> for prerequisite information.
                      {% endif %}
                    {% else %}
                      &nbsp;
                    {% endif %}
                    </td>

                    <td class="coreq">
                    {% if sections.0.course.corequisites %}
                      <strong>Co-requisites:  </strong>
                      {% if sections.0.course.corequisite_courses %}

                        {% for coreq in sections.0.course.corequisite_courses %}
                          {% if not forloop.first %}, {% endif %}
                            {% if coreq.coreq_course.section_set.all %}
                              <a href="{% url show_sections coreq.coreq_course.id %}">{{ coreq.coreq_course.prefix }} {{ coreq.coreq_course.course_number }}</a>
                            {% else %}
                              {{ coreq.coreq_course.prefix }} {{ coreq.coreq_course.course_number }}
                            {% endif %}
                        {% endfor %}
                      {% else %}
                        Please check the <a href="{{ catalog_url }}" target="_blank">catalog</a> for co-requisite information.
                      {% endif %}
                    {% else %}
                      &nbsp;
                    {% endif %}
                    </td>
                  </tr>
                </tbody>
                </table>
              {% endif %}

            {% if sections.0.course.note %}<p class="course-note"><strong>Note</strong> {{ sections.0.course.note }}</p>{% endif %}
          </div>
          <div class="clear"></div>
        </div>
        <div class="course-bottom"></div>
      </div>
              
      {% for section in sections %}
        <div class="section" id="{{ section.section_code }}">

          <div class="section-top">
            <div class="section-number">Section {{ section.section_number }}</div>
            <div class="section-heading">Meets</div>
            {% ifnotequal section.status 'Cancelled' %}
              <a class="add-item" href="#add" ref="section_{{ section.section_code }}"><img src="{% url appstatic "img/add_button.png" %}" alt="Add" /></a>
            {% endifnotequal %}
          </div>
          <div class="section-content">
            <div class="section-seats">
              <table>
                {% ifnotequal section.status 'Active' %}
                  <tr>
                    <td class="section-seats-label">&nbsp;</td>
                  </tr>
                  <tr>
                    <td class="section-seats-number">{{ section.status }}</td>
                  </tr>
                {% else %}
                  {% if section.available_seats %}
                    <tr>
                      <td class="section-seats-label">Seats Available</td>
                    </tr>
                    <tr>
                      <td class="section-seats-number">{{ section.available_seats }}</td>
                    </tr>
                  {% else %}
                    <tr>
                      <td class="section-seats-label">Seat information not available</td>
                    </tr>
                    <tr>
                      <td class="section-seats-number"></td>
                    </tr>
                  {% endif %}
                {% endifnotequal %}
                {% ifnotequal section.tuition "0.00" %}
                  <tr>
                    <td class="section-tuition">Tuition ${{ section.tuition }}</td>
                  </tr>
                {% endifnotequal %}
              </table>
            </div>

            <div class="section-meeting">
              <table>
              {% for meeting in section.meeting_set.all %}
                <tr>
                  <td class="section-campus">{{ section.campus }}</td>
                  <td class="section-room">Rm {{ meeting.building }} {{ meeting.room }}</td>
                  <td class="section-type">{{ meeting.meeting_type }}</td>
                  <td class="section-days">{{ meeting.days_of_week|days_of_week }}</td>
                  
                  <td class="section-time">{% if not meeting.is_online %}{{ meeting.start_time|time:"g:i A" }} - {{ meeting.end_time|time:"g:i A" }}{% endif %}</td>
                </tr>
              {% endfor %}
              <tr>
                <td colspan="2"><strong>From</strong> {{ section.start_date|date:"n-j-Y" }} <strong>to</strong> {{ section.end_date|date:"n-j-Y" }}</td>
                <td colspan="3"><strong>Term</strong> {{ section.term|format_term }} {{ section.year }} {% if section.session %}{{ section.session }}{% endif %}</td>
              </tr>
              <tr>
                <td colspan="5">{{section.delivery_type }}</td>
              </tr>
              {% if section.note %}
                <tr>
                  <td colspan="5"><strong>Note</strong> {{ section.note }}</td>
                </tr>
              {% endif %}
              </table>
            </div>
            <div class="clear"></div>
          </div>
          <div class="section-bottom">
            <div class="section-synonym">Synonym {{ section.synonym }}</div>
            <div class="section-instructor"><strong>Instructor</strong> {% if section.instructor_link %}<a href="{{ section.instructor_link }}">{{ section.instructor_name }}</a>{% else %}{{ section.instructor_name }}{% endif %}
            </div>
            <div class="section-books">
            {% if section.book_link %} <a class="open-window" ref="book" dialog-title="Book Information" href= "#book" booklink="{{ section.book_link }}">Book Information</a> <img src="{% url appstatic "img/book_icon.png" %}" alt="Book" />{% endif %}<br/>
            </div>

          </div>
          <div class="clear"></div>
        </div>
      {% endfor %}
      {% include "myschedule/dialogs/book.html" %}
    </form>
  {% else %}
    <p>There are no sections currently available for this course.</p>
  {% endif %}
{% endblock %}

